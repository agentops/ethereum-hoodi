name: Tests Terrafrorm code
on: 
    workflow_dispatch:
        inputs:
            environment:
                description: "Environment to deploy to"
                required: true
                default: dev
                type: choice
                options:
                    - dev
                    - staging
                    - prod


jobs:
    initialization:
        runs-on: ubuntu-latest
        if: ${{ inputs.environment == 'dev' || inputs.environment == 'staging' }}
        steps:
            - name: "Setup terraform"
              uses: hashicorp/setup-terraform@633666f66e0061ca3b725c73b2ec20cd13a8fdd1
            
            - name: "Checkout code"
              uses: actions/checkout@v3
              
            - name: "Terraform init"
              run: terraform init 
    
    planning:
        runs-on: ubuntu-latest
        needs: initialization
        steps:
            - name: "Setup terraform"
              uses: hashicorp/setup-terraform@633666f66e0061ca3b725c73b2ec20cd13a8fdd1
            
            - name: "Checkout code"
              uses: actions/checkout@v3
              
            - name: "Terraform plan"
              run: terraform plan -out=tfplan -input=false 
              
            - name: "Show plan"
              run: terraform show -no-color tfplan
              
          

